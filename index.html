 <!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Онлайн‑симулятор — Оценка финансового состояния логистической организации</title>
  <meta name="description" content="Учебный онлайн‑симулятор: оценка платежеспособности и кредитоспособности логистической организации (коэффициенты ликвидности, финансовой устойчивости и покрытия долга). Теория и тест." />
  <script src="https://cdn.tailwindcss.com"></script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>

  <style>
    html{scroll-behavior:smooth}
    @media (max-width: 767px){
      .mobile-tabbar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #e5e7eb;z-index:40}
      body{padding-bottom:72px}
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-900">
  <div id="root"></div>

  <script type="text/babel">
    const CASES = [
      {
        name: "Кейс A: «ЭкспрессТранс» — устойчиво",
        data: {
          periodDays: 365,
          // Активы
          cash: 850000,
          ar: 2400000,
          inventory: 350000,
          otherCA: 450000,
          fixedAssets: 6200000,
          // Пассивы
          currentLiab: 2000000,
          longLiab: 3100000,
          equity: 5150000,
          // Отчет о фин. результатах / потоках (за период)
          revenue: 12500000,
          ebit: 1450000,
          netProfit: 980000,
          interest: 220000,
          opCashFlow: 1150000,
          debtService: 900000
        }
      },
      {
        name: "Кейс B: «Склад+Доставка» – напряженно",
        data: {
          periodDays: 365,
          cash: 240000,
          ar: 5200000,
          inventory: 900000,
          otherCA: 600000,
          fixedAssets: 8500000,
          currentLiab: 5600000,
          longLiab: 6900000,
          equity: 2940000,
          revenue: 29800000,
          ebit: 1350000,
          netProfit: 520000,
          interest: 780000,
          opCashFlow: 650000,
          debtService: 2150000
        }
      },
      {
        name: "Кейс C: «B2B Логистика» – риск кассового разрыва",
        data: {
          periodDays: 365,
          cash: 90000,
          ar: 3600000,
          inventory: 650000,
          otherCA: 280000,
          fixedAssets: 4900000,
          currentLiab: 4400000,
          longLiab: 3800000,
          equity: 1320000,
          revenue: 9700000,
          ebit: 420000,
          netProfit: 120000,
          interest: 310000,
          opCashFlow: 130000,
          debtService: 1250000
        }
      }
    ];

            const dec2 = (n) =>
              Number(n || 0).toLocaleString('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              });

            const dec1 = (n) =>
              Number(n || 0).toLocaleString('ru-RU', {
                minimumFractionDigits: 1,
                maximumFractionDigits: 1
              });

            const money = (n) =>
              Number(n || 0).toLocaleString('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              });

            const num = (n) =>
              Number(n || 0).toLocaleString('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              });

            const pct = (x) =>
              (Number(x || 0) * 100).toLocaleString('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              }) + "%";

            const safe = (x) => (Number.isFinite(x) ? x : 0);

const TEACHER_CONTACT = {
  email: "vanya.muzychenko@gmail.com",
  telegram: "@mzchko"
};

function copyText(text){
  const t = String(text ?? "");
  if(!t) return;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(t).catch(()=>{});
    return;
  }
  const ta = document.createElement('textarea');
  ta.value = t;
  ta.setAttribute('readonly','');
  ta.style.position = 'fixed';
  ta.style.left = '-9999px';
  document.body.appendChild(ta);
  ta.select();
  try{ document.execCommand('copy'); }catch(e){}
  document.body.removeChild(ta);
}

    const QUIZ = [
      // 1) Ликвидность и платежеспособность
      { g:1, q:"Платежеспособность организации – это…", a:["уровень выручки","способность своевременно выполнять платежные обязательства","размер уставного капитала","численность персонала"], i:1, why:"Платежеспособность связана с возможностью платить по обязательствам в срок."},
      { g:1, q:"Коэффициент текущей ликвидности рассчитывается как:", a:["оборотные активы / краткосрочные обязательства","денежные средства / краткосрочные обязательства","краткосрочные обязательства / оборотные активы","выручка / активы"], i:0, why:"текущая ликвидность показывает покрытие краткосрочных обязательств оборотными активами."},
      { g:1, q:"Коэффициент быстрой (срочной) ликвидности обычно исключает из оборотных активов:", a:["денежные средства","дебиторскую задолженность","запасы","краткосрочные финансовые вложения"], i:2, why:"Запасы менее ликвидны, поэтому их исключают для оценки 'быстрой' ликвидности."},
      { g:1, q:"Абсолютная ликвидность отражает:", a:["покрытие обязательств исключительно денежными средствами и их эквивалентами","рентабельность продаж","оборачиваемость дебиторской задолженности","долю собственного капитала"], i:0, why:"Абсолютная ликвидность – самый жесткий критерий: только деньги/эквиваленты."},
      { g:1, q:"Рабочий капитал (чистый оборотный капитал) – это:", a:["оборотные активы − краткосрочные обязательства","выручка − себестоимость","собственный капитал − внеоборотные активы","активы − пассивы"], i:0, why:"Рабочий капитал показывает запас ликвидности для текущей деятельности."},

      // 2) Финансовая устойчивость
      { g:2, q:"Коэффициент автономии (финансовой независимости) – это:", a:["собственный капитал / валюта баланса","долг / выручка","прибыль до налогообложения / проценты","денежные средства / запасы"], i:0, why:"Автономия показывает долю активов, профинансированных собственным капиталом."},
      { g:2, q:"Если коэффициент автономии снижается, это чаще означает:", a:["рост финансовой независимости","рост зависимости от заемных источников","ускорение оборачиваемости запасов","увеличение чистой прибыли"], i:1, why:"Снижение автономии – рост доли заемного финансирования."},
      { g:2, q:"Соотношение заемного и собственного капитала (Долговая нагрузка) показывает:", a:["сколько дней 'висит' дебиторская задолженность","насколько компания закредитована относительно собственного капитала","объем продаж на рубль активов","структуру ассортимента"], i:1, why:"Debt/Equity – ключевой показатель долговой нагрузки."},
      { g:2, q:"Отрицательный рабочий капитал обычно сигнализирует:", a:["избыточный запас ликвидности","риск напряженности платежей в коротком периоде","высокую рентабельность","снижение долгов"], i:1, why:"Когда краткосрочные обязательства больше оборотных активов, риск кассового разрыва выше."},
      { g:2, q:"Наиболее ликвидная часть оборотных активов – это:", a:["запасы","дебиторская задолженность","денежные средства","основные средства"], i:2, why:"Деньги – самый ликвидный актив."},

      // 3) Кредитоспособность
      { g:3, q:"Кредитоспособность организации – это:", a:["способность получать любую субсидию","способность и готовность вернуть заем и проценты в срок","уровень технологичности автопарка","объем складских площадей"], i:1, why:"Кредитоспособность – вероятность своевременного обслуживания долга."},
      { g:3, q:"Коэффициент покрытия процентов (Interest Coverage) обычно равен:", a:["прибыль до налогообложения / процентные расходы","процентные расходы / прибыль до налогообложения","выручка / проценты","долг / активы"], i:0, why:"Показывает, сколько раз операционная прибыль покрывает проценты."},
      { g:3, q:"DSCR (покрытие долговой нагрузки) показывает:", a:["сколько раз денежный поток покрывает платежи по долгу","как быстро продаются запасы","долю собственного капитала","курс валюты"], i:0, why:"DSCR – показатель достаточности денежного потока для обслуживания долга."},
      { g:3, q:"Что из перечисленного ухудшает кредитоспособность сильнее всего?", a:["рост дебиторской задолженности при тех же продажах","рост денежного остатка","рост маржи","снижение процентных расходов"], i:0, why:"Рост дебиторской задолженности 'замораживает' деньги и повышает риск кассового разрыва."},
      { g:3, q:"Какой показатель относится к качеству расчетной дисциплины клиентов?", a:["DSO (дни дебиторской задолженности)","обязательства / собственный капитал","коэффициент автономии","рентабельность активов"], i:0, why:"DSO показывает средний срок погашения дебиторской задолженности."},

      // 4) Специфика логистики
      { g:4, q:"Для логистической организации типичный фактор риска платежеспособности:", a:["сезонность спроса и кассовые разрывы","всегда фиксированные цены топлива","отсутствие договоров с отсрочкой","нулевая дебиторка"], i:0, why:"Сезонность, топливо, отсрочки платежей и лизинг часто создают кассовые разрывы."},
      { g:4, q:"Что чаще всего увеличивает долговую нагрузку в логистике?", a:["лизинг транспорта/оборудования","снижение дебиторской задолженности","рост собственного капитала","уменьшение обязательств"], i:0, why:"Лизинг и кредиты на транспорт/склад повышают обязательства."},
      { g:4, q:"Если DSO растет, компании стоит в первую очередь:", a:["ускорить документооборот и взыскание дебиторской задолженности","увеличить запасы","уменьшить контроль платежей","снизить прозрачность учета"], i:0, why:"Рост DSO = деньги дольше 'висят' в дебиторке."},
      { g:4, q:"Платежный календарь помогает:", a:["планировать сроки платежей и избегать кассовых разрывов","увеличить площадь склада","снизить расход топлива напрямую","заменить бухгалтерский учет"], i:0, why:"Платежный календарь – инструмент управления ликвидностью."},
      { g:4, q:"Что из перечисленного относится к мерам повышения платежеспособности?", a:["лимиты на платежи, резерв ликвидности, кредитная линия","увеличение просрочек поставщикам","рост непрофильных активов","отмена контроля договоров"], i:0, why:"Лимиты, резерв, кредитная линия и ускорение поступлений – классические меры."}
    ];

    function grade(score01){
      if(score01 >= 0.9) return "Отлично";
      if(score01 >= 0.75) return "Хорошо";
      if(score01 >= 0.6) return "Удовлетворительно";
      return "Нужно повторить тему";
    }

    /* =========================================================
       UI
       ========================================================= */
    function TabLink({id,tab,setTab,children}){
      const active = tab===id;
      return (
        <button onClick={()=>setTab(id)}
                className={`px-3 py-1.5 rounded-xl border text-sm ${active?'bg-gray-100 border-gray-300':'hover:bg-gray-100'}`}>
          {children}
        </button>
      );
    }

    function Stat({label,value,sub,badge}){
      return (
        <div className="border rounded-xl p-3">
          <div className="flex items-center justify-between gap-2">
            <div className="text-xs text-gray-500">{label}</div>
            {badge && <span className="text-[10px] px-2 py-0.5 rounded-full border">{badge}</span>}
          </div>
          <div className="text-base font-semibold">{value}</div>
          {sub && <div className="text-xs text-gray-500 mt-1">{sub}</div>}
        </div>
      );
    }

    function Progress({value}){
      return (
        <div className="w-full h-2 rounded-full bg-gray-200 overflow-hidden">
          <div className="h-full bg-gray-900" style={{width: `${Math.min(100,Math.max(0,value))}%`}} />
        </div>
      );
    }

    function Field({ label, value, setValue, hint, suffix }) {
      const fmt = (n) =>
        Number(n || 0).toLocaleString('ru-RU', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });

      const parse = (s) => {
        const v = Number(String(s).replace(/\s/g, '').replace(',', '.'));
        return Number.isFinite(v) ? v : 0;
      };

      return (
        <div className="border rounded-2xl p-3">
          <label className="text-sm font-medium">{label}</label>

          <div className="mt-2 flex items-center gap-2">
            <input
              type="text"
              inputMode="decimal"
              value={fmt(value)}
              onChange={(e) => setValue(parse(e.target.value))}
              onBlur={(e) => setValue(parse(e.target.value))}
              className="w-full px-3 py-2 rounded-xl border focus:outline-none focus:ring-2 focus:ring-gray-200"
              placeholder="0,00"
            />
            {suffix && <div className="text-xs text-gray-500 whitespace-nowrap">{suffix}</div>}
          </div>

          {hint && <div className="text-xs text-gray-500 mt-1">{hint}</div>}
        </div>
      );
    }

    function DoughnutAssets({cash, ar, inventory, otherCA, fixedAssets, title}){
      const ref = React.useRef(null);
      const chartRef = React.useRef(null);

      React.useEffect(()=>{
        if(!ref.current) return;
        if(chartRef.current){ chartRef.current.destroy(); chartRef.current = null; }

        const values = [cash, ar, inventory, otherCA, fixedAssets].map(v=>Number(v||0));
        const labels = ["Деньги", "Дебиторская задолженность", "Запасы", "Прочие ОА", "Внеоборотные активы"];

        const ctx = ref.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'doughnut',
          data: { labels, datasets: [{ data: values, borderWidth: 1 }] },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' }, title: { display: !!title, text: title } },
            cutout: '60%'
          }
        });

        return ()=>{ if(chartRef.current){ chartRef.current.destroy(); chartRef.current = null; } };
      }, [cash, ar, inventory, otherCA, fixedAssets, title]);

      return (
        <div className="border rounded-2xl p-3">
          <div className="text-sm font-medium mb-2">{title}</div>
          <div className="h-64"><canvas ref={ref}></canvas></div>
          <div className="text-xs text-gray-500 mt-2">Структура активов для анализа ликвидности и рисков.</div>
        </div>
      );
    }

    function BarRatios({ratios}){
      const ref = React.useRef(null);
      const chartRef = React.useRef(null);

      React.useEffect(()=>{
        if(!ref.current) return;
        if(chartRef.current){ chartRef.current.destroy(); chartRef.current = null; }

        const labels = ratios.map(r=>r.name);
        const actual = ratios.map(r=>Number(r.value||0));
        const norm = ratios.map(r=>Number(r.norm||0));

        const ctx = ref.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'bar',
          data: { labels, datasets: [{ label:'Факт', data: actual }, { label:'Ориентир', data: norm }] },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position:'bottom' } },
            scales: { y: { beginAtZero: true } }
          }
        });

        return ()=>{ if(chartRef.current){ chartRef.current.destroy(); chartRef.current=null; } };
      }, [JSON.stringify(ratios)]);

      return (
        <div className="border rounded-2xl p-3">
          <div className="text-sm font-medium mb-2">Ключевые коэффициенты: факт vs ориентир</div>
          <div className="h-64"><canvas ref={ref}></canvas></div>
          <div className="text-xs text-gray-500 mt-2">Ориентиры учебные: в реальности нормы зависят от отрасли и условий.</div>
        </div>
      );
    }

    /* =========================================================
       Quiz question
       ========================================================= */
    function Q({item, idx, value, onChange, showResult}){
      return (
        <div className="py-4">
          <div className="flex items-start gap-2">
            <div className="text-xs mt-1 w-10 text-gray-500">#{idx+1}</div>
            <div className="min-w-0 flex-1">
              <div className="font-medium">{item.q}</div>
              <div className="mt-2 space-y-2">
                {item.a.map((opt, j)=>(
                  <label key={j} className={`flex items-start gap-2 p-2 rounded-xl border cursor-pointer hover:bg-gray-50 ${value===j?'bg-gray-50':''}`}>
                    <input type="radio" name={`q${idx}`} checked={value===j} onChange={()=>onChange(j)} className="mt-1"/>
                    <div className="text-sm">{opt}</div>
                  </label>
                ))}
              </div>
              {showResult && (
                <div className="mt-2 text-sm">
                  {value===item.i
                    ? <div className="text-emerald-700">Верно. <span className="text-gray-700">{item.why}</span></div>
                    : <div className="text-rose-700">Неверно. Правильно: <b>{item.a[item.i]}</b>. <span className="text-gray-700">{item.why}</span></div>
                  }
                </div>
              )}
              <div className="mt-2 text-[11px] text-gray-500">Блок {item.g}</div>
            </div>
          </div>
        </div>
      );
    }

    /* =========================================================
       Scoring
       ========================================================= */
    function scoreCredit({currentRatio, quickRatio, cashRatio, autonomy, debtToEquity, interestCoverage, dscr, dso}){
      let score = 0;

      if(currentRatio >= 1.5) score += 2;
      else if(currentRatio >= 1.0) score += 1;

      if(quickRatio >= 1.0) score += 2;
      else if(quickRatio >= 0.7) score += 1;

      if(cashRatio >= 0.2) score += 1;

      if(autonomy >= 0.5) score += 2;
      else if(autonomy >= 0.3) score += 1;

      if(debtToEquity > 0 && debtToEquity <= 1.5) score += 2;
      else if(debtToEquity > 0 && debtToEquity <= 2.5) score += 1;

      if(interestCoverage >= 3) score += 2;
      else if(interestCoverage >= 1.5) score += 1;

      if(dscr >= 1.2) score += 2;
      else if(dscr >= 1.0) score += 1;

      if(dso > 0 && dso <= 45) score += 1;
      else if(dso > 45 && dso <= 75) score += 0.5;

      let level = "C (рискованно)";
      let badge = "Высокий риск";
      if(score >= 11) { level = "A (высокая)"; badge="Низкий риск"; }
      else if(score >= 8) { level = "B (средняя)"; badge="Умеренный риск"; }

      return {score, level, badge};
    }


    function App(){
      const [tab,setTab] = React.useState('sim');
      const [caseIdx, setCaseIdx] = React.useState(-1);

      // Inputs
      const [periodDays, setPeriodDays] = React.useState(365);

      const [cash, setCash] = React.useState(0);
      const [ar, setAr] = React.useState(0);
      const [inventory, setInventory] = React.useState(0);
      const [otherCA, setOtherCA] = React.useState(0);
      const [fixedAssets, setFixedAssets] = React.useState(0);

      const [currentLiab, setCurrentLiab] = React.useState(0);
      const [longLiab, setLongLiab] = React.useState(0);
      const [equity, setEquity] = React.useState(0);


const [reportText, setReportText] = React.useState("");
      const [revenue, setRevenue] = React.useState(0);
      const [ebit, setEbit] = React.useState(0);
      const [netProfit, setNetProfit] = React.useState(0);
      const [interest, setInterest] = React.useState(0);
      const [opCashFlow, setOpCashFlow] = React.useState(0);
      const [debtService, setDebtService] = React.useState(0);

      const calc = React.useMemo(()=>{
        const pDays = Number(periodDays||0);

        const C = Number(cash||0);
        const AR = Number(ar||0);
        const INV = Number(inventory||0);
        const OCA = Number(otherCA||0);
        const FA = Number(fixedAssets||0);

        const CA = C + AR + INV + OCA;
        const TA = CA + FA;

        const CL = Number(currentLiab||0);
        const LL = Number(longLiab||0);
        const EQ = Number(equity||0);
        const TL = CL + LL;

        const REV = Number(revenue||0);
        const EBIT = Number(ebit||0);
        const NP = Number(netProfit||0);
        const INT = Number(interest||0);
        const CFO = Number(opCashFlow||0);
        const DS = Number(debtService||0);

        const currentRatio = CL>0 ? CA/CL : 0;
        const quickRatio = CL>0 ? (C+AR+OCA)/CL : 0;
        const cashRatio = CL>0 ? C/CL : 0;
        const workingCapital = CA - CL;

        const autonomy = TA>0 ? EQ/TA : 0;
        const debtToEquity = EQ>0 ? TL/EQ : 0;
        const leverage = TA>0 ? TL/TA : 0;

        const interestCoverage = INT>0 ? EBIT/INT : 0;
        const dscr = DS>0 ? CFO/DS : 0;

        const arTurnover = AR>0 ? REV/AR : 0;
        const dso = (REV>0 && pDays>0) ? (AR/REV)*pDays : 0;

        const netMargin = REV>0 ? NP/REV : 0;

        const score = scoreCredit({currentRatio, quickRatio, cashRatio, autonomy, debtToEquity, interestCoverage, dscr, dso});

        return {pDays, C, AR, INV, OCA, FA, CA, TA, CL, LL, EQ, TL, REV, EBIT, NP, INT, CFO, DS,
                currentRatio, quickRatio, cashRatio, workingCapital, autonomy, debtToEquity, leverage,
                interestCoverage, dscr, arTurnover, dso, netMargin, score};
      }, [periodDays, cash, ar, inventory, otherCA, fixedAssets, currentLiab, longLiab, equity, revenue, ebit, netProfit, interest, opCashFlow, debtService]);

      const insights = React.useMemo(()=>{
        const r = calc;
        const out = [];

        if(r.currentRatio >= 1.5) out.push(<>Текущая ликвидность <b>нормальная</b> ({dec2(r.currentRatio)}).</>);
        else if(r.currentRatio >= 1.0) out.push(<>Текущая ликвидность <b>на грани</b> ({dec2(r.currentRatio)}): важен платежный календарь.</>);
        else out.push(<>Текущая ликвидность <b>низкая</b> ({dec2(r.currentRatio)}): риск кассового разрыва.</>);

        if(r.quickRatio >= 1.0) out.push(<>Быстрая ликвидность <b>хорошая</b> ({dec2(r.quickRatio)}).</>);
        else if(r.quickRatio >= 0.7) out.push(<>Быстрая ликвидность <b>умеренная</b> ({dec2(r.quickRatio)}): ускоряйте дебиторку.</>);
        else out.push(<>Быстрая ликвидность <b>слабая</b> ({dec2(r.quickRatio)}).</>);

        if(r.cashRatio >= 0.2) out.push(<>Абсолютная ликвидность <b>приемлемая</b> ({dec2(r.cashRatio)}).</>);
        else out.push(<>Абсолютная ликвидность <b>низкая</b> ({dec2(r.cashRatio)}): срочные платежи под риском.</>);

        if(r.dso > 0){
          if(r.dso <= 45) out.push(<>DSO <b>хороший</b> ≈ {r.dso.toFixed(0)} дн.: деньги быстро возвращаются.</>);
          else if(r.dso <= 75) out.push(<>DSO <b>повышен</b> ≈ {r.dso.toFixed(0)} дн.: усилить контроль договоров/актов/лимитов.</>);
          else out.push(<>DSO <b>высокий</b> ≈ {r.dso.toFixed(0)} дн.: дебиторская задолженноссть “замораживает” ликвидность.</>);
        } else {
          out.push(<>Срок погашения дебиторской задолженности не рассчитан: задайте выручку и дебиторку.</>);
        }

        if(r.autonomy >= 0.5) out.push(<>Автономия <b>высокая</b> ({pct(r.autonomy)}).</>);
        else if(r.autonomy >= 0.3) out.push(<>Автономия <b>умеренная</b> ({pct(r.autonomy)}).</>);
        else out.push(<>Автономия <b>низкая</b> ({pct(r.autonomy)}): высокая зависимость от кредиторов.</>);

        if(r.debtToEquity > 0){
          if(r.debtToEquity <= 1.5) out.push(<>Debt/Equity <b>приемлемый</b>: {r.debtToEquity.toFixed(2)}.</>);
          else if(r.debtToEquity <= 2.5) out.push(<>Debt/Equity <b>повышен</b>: {r.debtToEquity.toFixed(2)}.</>);
          else out.push(<>Debt/Equity <b>высокий</b>: {r.debtToEquity.toFixed(2)}.</>);
        } else {
          out.push(<>Коэффициент долговой нагрузки не рассчитан: собственный капитал = 0.</>);
        }

        if(r.interest > 0){
          if(r.interestCoverage >= 3) out.push(<>Покрытие процентов (EBIT/%) <b>хорошее</b>: {r.interestCoverage.toFixed(2)}.</>);
          else if(r.interestCoverage >= 1.5) out.push(<>Покрытие процентов <b>напряженное</b>: {r.interestCoverage.toFixed(2)}.</>);
          else out.push(<>Покрытие процентов <b>низкое</b>: {r.interestCoverage.toFixed(2)}.</>);
        } else {
          out.push(<>Проценты = 0: показатель покрытия процентов не рассчитывается.</>);
        }

        if(r.debtService > 0){
          if(r.dscr >= 1.2) out.push(<>DSCR <b>нормальный</b>: {r.dscr.toFixed(2)}.</>);
          else if(r.dscr >= 1.0) out.push(<>DSCR <b>на грани</b>: {r.dscr.toFixed(2)}.</>);
          else out.push(<>DSCR <b>ниже 1</b>: {r.dscr.toFixed(2)} — денег не хватает на долг.</>);
        } else {
          out.push(<>Обслуживание долга = 0: Коэффициент покрытия долга не рассчитывается.</>);
        }

        out.push(<>Итоговая учебная оценка: <b>{r.score.level}</b> (балл {r.score.score.toFixed(1)}), риск: <b>{r.score.badge}</b>.</>);

        return out;
      }, [calc]);

      function loadCase(i){
        const d = CASES[i].data;
        setCaseIdx(i);

        setCash(d.cash); setAr(d.ar); setInventory(d.inventory); setOtherCA(d.otherCA); setFixedAssets(d.fixedAssets);
        setCurrentLiab(d.currentLiab); setLongLiab(d.longLiab); setEquity(d.equity);
        setRevenue(d.revenue); setEbit(d.ebit); setNetProfit(d.netProfit);
        setInterest(d.interest); setOpCashFlow(d.opCashFlow); setDebtService(d.debtService);
      }

      function reset(){
        setCaseIdx(-1);
        setPeriodDays(365);
        setCash(0); setAr(0); setInventory(0); setOtherCA(0); setFixedAssets(0);
        setCurrentLiab(0); setLongLiab(0); setEquity(0);
        setRevenue(0); setEbit(0); setNetProfit(0); setInterest(0); setOpCashFlow(0); setDebtService(0);
      }

      function randomCase(){
        const rnd = (min,max)=> Math.round(min + Math.random()*(max-min));
        setCaseIdx(-1);

        setCash(rnd(50000, 1500000));
        setAr(rnd(500000, 8000000));
        setInventory(rnd(0, 1500000));
        setOtherCA(rnd(100000, 1200000));
        setFixedAssets(rnd(1000000, 12000000));

        setCurrentLiab(rnd(500000, 7000000));
        setLongLiab(rnd(0, 9000000));
        setEquity(rnd(200000, 8000000));

        setRevenue(rnd(2000000, 40000000));
        setEbit(rnd(100000, 3000000));
        setNetProfit(rnd(0, 2000000));
        setInterest(rnd(0, 1200000));
        setOpCashFlow(rnd(0, 2500000));
        setDebtService(rnd(0, 3000000));
      }

const teacherEmail = TEACHER_CONTACT.email;
const teacherTg = (TEACHER_CONTACT.telegram || "").replace(/^@/, "");
const reportSubject = "Отчет по ПЗ: Оценка финансового состояния логистической организации";

const mailtoHref = React.useMemo(() => {
  return "mailto:" + encodeURIComponent(teacherEmail)
    + "?subject=" + encodeURIComponent(reportSubject)
    + "&body=" + encodeURIComponent(reportText || "");
}, [teacherEmail, reportSubject, reportText]);

const gmailHref = React.useMemo(() => {
  return "https://mail.google.com/mail/?view=cm&fs=1"
    + "&to=" + encodeURIComponent(teacherEmail)
    + "&su=" + encodeURIComponent(reportSubject)
    + "&body=" + encodeURIComponent(reportText || "");
}, [teacherEmail, reportSubject, reportText]);

const tgHref = React.useMemo(() => {
  return "https://t.me/" + encodeURIComponent(teacherTg);
}, [teacherTg]);


      function exportCalc(){
        const rows = [
          ["Показатель","Значение"],
          ["Кейс", caseIdx>=0 ? CASES[caseIdx].name : "Вручную/случайный"],
          ["Период, дней", calc.pDays],
          ["Деньги", calc.C],
          ["Дебиторская задолженность", calc.AR],
          ["Запасы", calc.INV],
          ["Прочие ОА", calc.OCA],
          ["Внеоборотные активы", calc.FA],
          ["Оборотные активы", calc.CA],
          ["Активы всего", calc.TA],
          ["Краткосрочные обязательства", calc.CL],
          ["Долгосрочные обязательства", calc.LL],
          ["Собственный капитал", calc.EQ],
          ["Обязательства всего", calc.TL],
          ["Выручка", calc.REV],
          ["Прибыль до н/о", calc.EBIT],
          ["Чистая прибыль", calc.NP],
          ["Проценты", calc.INT],
          ["Операционный денежный поток", calc.CFO],
          ["Обслуживание долга", calc.DS],
          ["Текущая ликвидность", calc.currentRatio],
          ["Быстрая ликвидность", calc.quickRatio],
          ["Абсолютная ликвидность", calc.cashRatio],
          ["Рабочий капитал", calc.workingCapital],
          ["Автономия", calc.autonomy],
          ["Долговая нагрузка", calc.debtToEquity],
          ["Коэффициент покрытия процентов", calc.interestCoverage],
          ["Коэффициент покрытия долга", calc.dscr],
          ["Срок погашения дебиторской задолженности, дней", calc.dso],
          ["Итог балл", calc.score.score],
          ["Уровень", calc.score.level],
          ["Риск", calc.score.badge]
        ];
        const csv = rows.map(r=> r.map(v=> `"${String(v).replaceAll('"','""')}"`).join(';')).join('\n');
        const blob=new Blob(["\ufeff"+csv],{type:"text/csv;charset=utf-8;"});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download='calc_fin_state_logistics.csv'; a.click();
        URL.revokeObjectURL(url);
      }

      function exportQuiz(){
        const correctCount = answers.reduce((s,a,i)=> s + (a===QUIZ[i].i?1:0),0);
        const lines=[];
        lines.push(`Тест: ${correctCount}/${QUIZ.length} (${Math.round(correctCount/QUIZ.length*100)}%)`);
        lines.push(`Оценка: ${grade(correctCount/QUIZ.length)}`);
        lines.push("");
        QUIZ.forEach((q,idx)=>{
          const u=answers[idx]; const ok = u===q.i;
          lines.push(`${idx+1}. [Блок ${q.g}] ${q.q}`);
          lines.push(`   Ваш ответ: ${u!==null? q.a[u]:"—"}`);
          lines.push(`   Верно: ${q.a[q.i]}`);
          lines.push(`   Пояснение: ${q.why}`);
          lines.push(`   Результат: ${ok?"верно":"ошибка"}`);
          lines.push("");
        });
        const blob=new Blob([lines.join('\n')],{type:"text/plain;charset=utf-8;"});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download='quiz_result_fin_state_logistics.txt'; a.click();
        URL.revokeObjectURL(url);
      }

      const ratiosForChart = React.useMemo(()=>[
        {name:"Текущая", value: safe(calc.currentRatio), norm: 1.5},
        {name:"Быстрая", value: safe(calc.quickRatio), norm: 1.0},
        {name:"Абсолютн.", value: safe(calc.cashRatio), norm: 0.2},
        {name:"Автономия", value: safe(calc.autonomy), norm: 0.5},
        {name:"Долговая нагрузка", value: safe(calc.debtToEquity), norm: 1.5},
        {name:"Коэфф. покр. %", value: safe(calc.interestCoverage), norm: 3.0},
        {name:"Коэфф. покр. долга", value: safe(calc.dscr), norm: 1.2}
      ], [calc]);

      // Quiz state
      const [answers,setAnswers] = React.useState(Array(QUIZ.length).fill(null));
      const [showResult,setShowResult] = React.useState(false);
      const correctCount = answers.reduce((s,a,i)=> s + (a===QUIZ[i].i?1:0),0);
      const progress = Math.round(answers.filter(v=>v!==null).length/QUIZ.length*100);

      return (
        <div className="min-h-screen">
          <header className="sticky top-0 z-20 bg-white/90 backdrop-blur border-b">
            <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
              <div className="min-w-0">
                <div className="text-[10px] sm:text-xs text-gray-500 truncate">
                  Оценка финансового состояния логистической организации · платежеспособность и кредитоспособность
                </div>
                <h1 className="text-base sm:text-xl font-bold truncate">Онлайн‑симулятор</h1>
              </div>

              <nav className="hidden md:flex gap-2 text-sm">
                <TabLink id="sim" tab={tab} setTab={setTab}>Симулятор (ПЗ)</TabLink>
                <TabLink id="learn" tab={tab} setTab={setTab}>Теория</TabLink>
                <TabLink id="quiz" tab={tab} setTab={setTab}>Тест (20)</TabLink>
                <TabLink id="about" tab={tab} setTab={setTab}>Инструкция</TabLink>
              </nav>
            </div>
          </header>

          <nav className="mobile-tabbar md:hidden">
            <div className="max-w-6xl mx-auto px-2 py-2 grid grid-cols-4 gap-2 text-xs">
              <button onClick={()=>setTab('sim')} className={`px-2 py-2 rounded-xl border ${tab==='sim'?'bg-gray-100':''}`}>ПЗ</button>
              <button onClick={()=>setTab('learn')} className={`px-2 py-2 rounded-xl border ${tab==='learn'?'bg-gray-100':''}`}>Теория</button>
              <button onClick={()=>setTab('quiz')} className={`px-2 py-2 rounded-xl border ${tab==='quiz'?'bg-gray-100':''}`}>Тест</button>
              <button onClick={()=>setTab('about')} className={`px-2 py-2 rounded-xl border ${tab==='about'?'bg-gray-100':''}`}>Инстр.</button>
            </div>
          </nav>

          <main className="max-w-6xl mx-auto px-2 sm:px-4 py-4 sm:py-6 space-y-6">

            {tab === 'sim' && (
              <section className="grid lg:grid-cols-3 gap-4 sm:gap-6">
                <div className="lg:col-span-2 bg-white border rounded-2xl p-3 sm:p-4 shadow-sm space-y-4">
                  <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                    <div>
                      <h2 className="font-semibold text-base sm:text-lg leading-tight">
                        Практическое задание: оценка финансового<br />
                        <span className="block -mt-1">состояния</span>
                      </h2>
                      <div className="text-xs text-gray-600">Выберите кейс или вводите значения вручную. Кнопка «Сброс» возвращает нули.</div>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {CASES.map((c,i)=>(
                        <button key={i} onClick={()=>loadCase(i)}
                          className={`px-3 py-1.5 rounded-xl border text-sm hover:bg-gray-100 ${caseIdx===i?'bg-gray-100':''}`}>
                          {String.fromCharCode(65+i)}
                        </button>
                      ))}
                      <button onClick={randomCase} className="px-3 py-1.5 rounded-xl border text-sm hover:bg-gray-100">Случайный</button>
                      <button onClick={reset} className="px-3 py-1.5 rounded-xl border text-sm hover:bg-gray-100">Сброс</button>
                    </div>
                  </div>

                  <div className="border rounded-2xl p-3 space-y-3">
                    <div className="font-medium">Баланс (активы)</div>
                    <div className="grid sm:grid-cols-2 gap-3">
                      <Field label="Денежные средства" value={cash} setValue={setCash} hint="Касса + счета + эквиваленты (укрупненно)." />
                      <Field label="Дебиторская задолженность" value={ar} setValue={setAr} hint="Деньги от клиентов, еще не поступившие." />
                      <Field label="Запасы" value={inventory} setValue={setInventory} hint="ГСМ/упаковка/запчасти и т.п." />
                      <Field label="Прочие оборотные активы" value={otherCA} setValue={setOtherCA} hint="Авансы, НДС, прочее." />
                      <Field label="Внеоборотные активы" value={fixedAssets} setValue={setFixedAssets} hint="Транспорт/склад/оборудование." />
                    </div>
                    <div className="text-sm text-gray-700">
                      <div><b>Оборотные активы</b> = деньги + дебиторская задолженность + запасы + прочие ОА</div>
                      <div><b>Активы всего</b> = оборотные активы + внеоборотные активы</div>
                    </div>
                  </div>

                  <div className="border rounded-2xl p-3 space-y-3">
                    <div className="font-medium">Баланс (пассивы)</div>
                    <div className="grid sm:grid-cols-2 gap-3">
                      <Field label="Краткосрочные обязательства" value={currentLiab} setValue={setCurrentLiab} hint="Кредиторка, налоги, краткосрочные кредиты и т.п." />
                      <Field label="Долгосрочные обязательства" value={longLiab} setValue={setLongLiab} hint="Долгосрочные кредиты/лизинг и пр." />
                      <Field label="Собственный капитал" value={equity} setValue={setEquity} hint="УК + нераспределенная прибыль и др." />
                    </div>
                    <div className="text-sm text-gray-700"><b>Обязательства всего</b> = краткосрочные + долгосрочные</div>
                  </div>

                  <div className="border rounded-2xl p-3 space-y-3">
                    <div className="flex items-center justify-between gap-3 flex-wrap">
                      <div>
                        <div className="font-medium">Результаты и долг</div>
                        <div className="text-xs text-gray-600">За тот же период.</div>
                      </div>
                      <button onClick={exportCalc} className="px-3 py-1.5 rounded-xl border text-sm hover:bg-gray-100">Экспорт расчета (CSV)</button>
                    </div>

                    <div className="grid sm:grid-cols-2 gap-3">
                      <Field label="Выручка" value={revenue} setValue={setRevenue} hint="Доходы от услуг логистики." />
                      <Field label="Прибыль до н/о" value={ebit} setValue={setEbit} hint="Прибыль до процентов и налогов." />
                      <Field label="Чистая прибыль" value={netProfit} setValue={setNetProfit} hint="Опционально (маржа)." />
                      <Field label="Процентные расходы" value={interest} setValue={setInterest} hint="Проценты по кредитам/лизингу." />
                      <Field label="Опер. денежный поток" value={opCashFlow} setValue={setOpCashFlow} hint="ДП от основной деятельности." />
                      <Field label="Платежи по долгу (осн.+%)" value={debtService} setValue={setDebtService} hint="Суммарно за период." />
                    </div>

                    <div className="text-sm text-gray-700">
                      <div><b>EBIT/%</b> = Прибыль до н/о / проценты</div>
                      <div><b>DSCR</b> = Опер. ДП / (основной долг + %)</div>
                      <div><b>DSO</b> = (дебиторская задолженность / выручка) × дни периода</div>
                    </div>

                    <div id="report-panel" className="border rounded-2xl p-4 bg-white">
                      <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                        <div>
                          <div className="font-semibold">Отчет для отправки</div>
                          <div className="text-xs text-gray-500">Заполните текст и отправьте преподавателю.</div>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => copyText(reportText || "")}
                            className="px-3 py-2 rounded-xl border text-sm hover:bg-gray-100"
                            title="Скопировать текст отчета"
                          >
                            Скопировать
                          </button>
                          <button
                            onClick={() => setReportText("")}
                            className="px-3 py-2 rounded-xl border text-sm hover:bg-gray-100"
                            title="Очистить поле"
                          >
                            Очистить
                          </button>
                        </div>
                      </div>

                      <textarea
                        className="mt-3 w-full min-h-[160px] px-3 py-2 rounded-xl border focus:outline-none focus:ring-2 focus:ring-gray-200 text-sm"
                        value={reportText}
                        onChange={(e) => setReportText(e.target.value)}
                        placeholder={"Структура (пример):\n1) Исходные данные (что задано)\n2) Рассчитанные коэффициенты\n3) Вывод о платежеспособности\n4) Вывод о кредитоспособности\n5) Рекомендации"}
                      />

                        <div className="grid sm:grid-cols-2 gap-2 mt-3 justify-center items-center">
                        <a
                          href={mailtoHref}
                          className="px-3 py-2 rounded-xl border text-sm text-center hover:bg-gray-100"
                        >
                          Открыть Gmail
                        </a>
                        <a
                          href={tgHref}
                          target="_blank"
                          rel="noreferrer"
                          className="px-3 py-2 rounded-xl border text-sm text-center hover:bg-gray-100"
                        >
                          Telegram
                        </a>
                      </div>
                    </div>

                  </div>
                </div>

                <aside className="bg-white border rounded-2xl p-3 sm:p-4 shadow-sm space-y-3">
                  <div className="text-sm text-gray-600">Текущий набор данных:</div>
                  <div className="text-base font-semibold">{caseIdx>=0 ? CASES[caseIdx].name : "Вручную / случайный кейс"}</div>

                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <Stat label="Оборотные активы" value={money(calc.CA)} sub="Ликвидная часть" />
                    <Stat label="Активы всего" value={money(calc.TA)} sub="Валюта баланса" />
                    <Stat label="Краткоср. обяз-ва" value={money(calc.CL)} sub="Платежи скоро" />
                    <Stat label="Рабочий капитал" value={money(calc.workingCapital)} sub="ОА − КО" badge={calc.workingCapital>=0?"плюс":"минус"} />
                  </div>

                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <Stat label="Текущая ликвидн." value={calc.currentRatio.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})} sub="ОА/КО" badge={calc.currentRatio>=1.5?"норма":(calc.currentRatio>=1.0?"грани":"риск")} />
                    <Stat label="Быстрая ликвидн." value={calc.quickRatio.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})} sub="(ДС+ДЗ+проч. ОА)/КО" badge={calc.quickRatio>=1.0?"норма":(calc.quickRatio>=0.7?"грани":"риск")} />
                    <Stat label="Абсолютная" value={calc.cashRatio.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})} sub="Д/КО" badge={calc.cashRatio>=0.2?"норма":"низк"} />
                    <Stat label="Автономия" value={pct(calc.autonomy)} sub="СК/Активы" badge={calc.autonomy>=0.5?"высок":(calc.autonomy>=0.3?"сред":"низк")} />
                  </div>

                  <div className="grid grid-cols-2 gap-2 text-sm">
                    <Stat label="Долговая нагрузка" value={calc.debtToEquity ? calc.debtToEquity.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2}) : "н/д"} sub="Обяз./СК" badge={(calc.debtToEquity>0 && calc.debtToEquity<=1.5)?"норма":((calc.debtToEquity>0 && calc.debtToEquity<=2.5)?"высок":"риск")} />
                    <Stat label="Коэффициент покрытия процентов" value={calc.interestCoverage ? calc.interestCoverage.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2}) : "н/д"} sub="Покрытие %" badge={calc.interestCoverage>=3?"норма":(calc.interestCoverage>=1.5?"грани":"риск")} />

                    <Stat
                      label="Коэффициент покрытия долга"
                      value={calc.dscr
                        ? calc.dscr.toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2})
                        : "н/д"}
                      sub="Опер. ДП/Обяз."
                      badge={calc.dscr>=1.2?"норма":(calc.dscr>=1.0?"грани":"риск")}
                    />

                    <Stat label="Срок погашения деб. зад-ти" value={calc.dso ? calc.dso.toLocaleString('ru-RU',{maximumFractionDigits:0}) + " дн." : "н/д"} sub="Дни ДЗ" badge={(calc.dso>0 && calc.dso<=45)?"норма":((calc.dso>45 && calc.dso<=75)?"высок":"риск")} />
                  </div>

                  <div className="border rounded-2xl p-3">
                    <div className="flex items-center justify-between">
                      <div className="font-medium">Кредитоспособность</div>
                      <span className="text-[11px] px-2 py-1 rounded-full border">{calc.score.badge}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-700">
                      Уровень: <b>{calc.score.level}</b> · Балл: <b>{calc.score.score.toFixed(1)}</b>
                    </div>
                  </div>

                  <DoughnutAssets title="Структура активов" cash={cash} ar={ar} inventory={inventory} otherCA={otherCA} fixedAssets={fixedAssets} />
                  <BarRatios ratios={ratiosForChart} />

                  <div className="border rounded-2xl p-3 text-sm text-gray-700">
                    <div className="font-medium mb-1">Мини‑вывод</div>
                    <ul className="list-disc pl-5 space-y-1">{insights.map((x,i)=><li key={i}>{x}</li>)}</ul>
                  </div>
                </aside>
              </section>
            )}

            {tab === 'learn' && (
              <section className="bg-white rounded-2xl shadow border p-3 sm:p-4 space-y-4">
                <h2 className="font-semibold text-base sm:text-lg">
                  Теория: платежеспособность и кредитоспособность
                </h2>

                <details className="border rounded-xl p-3">
                  <summary className="cursor-pointer font-medium">
                    1. Платежеспособность и ликвидность
                  </summary>
                  <div className="mt-2 text-sm text-gray-800 space-y-2">
                    <p>
                      <b>Платежеспособность</b> – это способность организации
                      <b> своевременно исполнять свои обязательства</b>:
                      перед поставщиками, сотрудниками, государством и банками.
                    </p>

                    <p>
                      <b>Ликвидность</b> показывает, <b>насколько быстро активы могут
                      быть превращены в деньги</b>. Денежные средства являются
                      наиболее ликвидным активом, запасы – наименее ликвидным.
                    </p>

                    <div className="border rounded-xl p-3 bg-gray-50 space-y-1">
                      <div><b>Коэффициент текущей ликвидности (Ктл)</b> = Оборотные активы / Краткосрочные обязательства</div>
                      <div className="text-xs text-gray-600">
                        Показывает, достаточно ли оборотных активов для погашения краткосрочных обязательств.
                      </div>

                      <div className="pt-1"><b>Коэффициент быстрой ликвидности (Ксл)</b> = (Оборотные активы – Запасы) / Краткосрочные обязательства</div>
                      <div className="text-xs text-gray-600">
                        Учитывает только те активы, которые могут быть быстро обращены в деньги.
                      </div>

                      <div className="pt-1"><b>Коэффициент абсолютной ликвидности (Кал)</b> = Денежные средства / Краткосрочные обязательства</div>
                      <div className="text-xs text-gray-600">
                        Характеризует долю обязательств, которую организация может погасить немедленно.
                      </div>

                      <div className="pt-1"><b>Рабочий капитал</b> = Оборотные активы – Краткосрочные обязательства</div>
                      <div className="text-xs text-gray-600">
                        Отражает запас финансовой устойчивости для текущей деятельности.
                      </div>
                    </div>
                  </div>
                </details>

                <details className="border rounded-xl p-3">
                  <summary className="cursor-pointer font-medium">
                    2. Финансовая устойчивость
                  </summary>
                  <div className="mt-2 text-sm text-gray-800 space-y-2">
                    <p>
                      <b>Финансовая устойчивость</b> характеризует степень
                      <b> зависимости организации от заемных источников финансирования</b>.
                    </p>

                    <div className="border rounded-xl p-3 bg-gray-50 space-y-1">
                      <div><b>Коэффициент автономии</b> = Собственный капитал / Активы всего</div>
                      <div className="text-xs text-gray-600">
                        Чем выше показатель, тем выше финансовая независимость организации.
                      </div>

                      <div className="pt-1"><b>Долговая нагрузка (Debt/Equity)</b> = Обязательства всего / Собственный капитал</div>
                      <div className="text-xs text-gray-600">
                        Показывает, сколько заемных средств приходится на один рубль собственного капитала.
                      </div>
                    </div>
                  </div>
                </details>

                <details className="border rounded-xl p-3">
                  <summary className="cursor-pointer font-medium">
                    3. Кредитоспособность
                  </summary>
                  <div className="mt-2 text-sm text-gray-800 space-y-2">
                    <p>
                      <b>Кредитоспособность</b> – это способность организации
                      <b> своевременно обслуживать заемные обязательства</b>,
                      включая выплату процентов и возврат основного долга.
                    </p>

                    <div className="border rounded-xl p-3 bg-gray-50 space-y-1">
                      <div><b>Покрытие процентов (EBIT/%)</b> = EBIT / Процентные расходы</div>
                      <div className="text-xs text-gray-600">
                        Показывает, достаточно ли прибыли для выплаты процентов по заемным средствам.
                      </div>

                      <div className="pt-1"><b>DSCR</b> = Операционный денежный поток / Платежи по долгу</div>
                      <div className="text-xs text-gray-600">
                        Характеризует способность денежного потока покрывать долговые обязательства.
                      </div>

                      <div className="pt-1"><b>DSO</b> = (Дебиторская задолженность / Выручка) × Дни периода</div>
                      <div className="text-xs text-gray-600">
                        Отражает средний срок оплаты услуг со стороны клиентов.
                      </div>
                    </div>
                  </div>
                </details>

                <details className="border rounded-xl p-3">
                  <summary className="cursor-pointer font-medium">
                    4. Специфика логистических организаций
                  </summary>
                  <div className="mt-2 text-sm text-gray-800 space-y-2">
                    <ul className="list-disc pl-5 space-y-1">
                      <li>Сезонность перевозок – риск кассовых разрывов.</li>
                      <li>Отсрочки оплаты – рост дебиторской задолженности.</li>
                      <li>Лизинг транспорта – регулярные обязательные платежи.</li>
                      <li>Колебания цен на топливо – влияние на уровень маржи.</li>
                    </ul>

                    <div className="border rounded-xl p-3 bg-gray-50 mt-2">
                      <div className="font-medium">Инструменты управления</div>
                      <div className="text-sm text-gray-700 mt-1">
                        Платежный календарь, лимиты расходов, резерв ликвидности,
                        контроль дебиторской задолженности, использование кредитной линии.
                      </div>
                    </div>
                  </div>
                </details>
              </section>
            )}

            {tab === 'quiz' && (
              <section className="bg-white rounded-2xl shadow border p-3 sm:p-4 space-y-4">
                <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                  <div>
                    <h2 className="font-semibold text-base sm:text-lg">Тест по теме (20 вопросов)</h2>
                  </div>
                  <div className="w-full sm:w-56">
                    <Progress value={progress} />
                    <div className="text-xs text-gray-500 mt-1">Заполнено: {progress}%</div>
                  </div>
                </div>

                <div className="divide-y">
                  {QUIZ.map((item, idx) => (
                    <Q
                      key={idx}
                      item={item}
                      idx={idx}
                      value={answers[idx]}
                      onChange={(v) => setAnswers(a => { const b=[...a]; b[idx]=v; return b; })}
                      showResult={showResult}
                    />
                  ))}
                </div>

                <div className="flex flex-col sm:flex-row sm:items-center gap-2">
                  <div className="flex flex-wrap gap-2">
                    <button onClick={()=>setShowResult(true)} className="px-3 py-1.5 rounded-xl border hover:bg-gray-100">Проверить</button>
                    <button onClick={()=>{setAnswers(Array(QUIZ.length).fill(null)); setShowResult(false);}} className="px-3 py-1.5 rounded-xl border hover:bg-gray-100">Сброс ответов</button>
                    <button onClick={exportQuiz} className="px-3 py-1.5 rounded-xl border hover:bg-gray-100">Экспорт результата (TXT)</button>
                  </div>

                  <div className="text-sm text-gray-700 sm:ml-auto">
                    {showResult && (<span>Результат: <b>{correctCount}/{QUIZ.length}</b> — {grade(correctCount/QUIZ.length)}</span>)}
                  </div>
                </div>
              </section>
            )}

            {tab === 'about' && (
              <section className="bg-white rounded-2xl shadow border p-3 sm:p-4 space-y-3">
                <h2 className="font-semibold text-base sm:text-lg">Инструкция: как выполнить ПЗ</h2>
                <ol className="list-decimal pl-5 space-y-2 text-sm text-gray-800">
                  <li>Выберите кейс или введите данные вручную.</li>
                  <li>Заполните укрупненные статьи баланса (активы/пассивы).</li>
                  <li>Заполните выручку, прибыль до налогообложения, проценты, операционный денежный поток и платежи по долгу.</li>
                  <li>Снимите коэффициенты: текущая/быстрая/абсолютная ликвидность, автономия, Долговая нагрузка, Коэффициент покрытия процентов, Коэффициент покрытия долга, Срок погашения деб. зад-ти.</li>
                  <li>Сделайте вывод о платежеспособности и кредитоспособности.</li>
                </ol>

                <div className="border rounded-2xl p-3 bg-gray-50 text-sm text-gray-800">
                  <div className="font-medium mb-1">Шаблон вывода</div>
                  <p>
                    Рассчитаны показатели ликвидности (Ктл=…, Ксл=…, Кал=…) и финансовой устойчивости (автономия=…, Долговая нагрузка=…).
                    Показатели кредитоспособности: покрытие процентов (EBIT/%)=…, DSCR=…, DSO≈… дней.
                    На основании расчета организация является (платежеспособной/напряженной/рисковой) и имеет (высокую/среднюю/низкую) кредитоспособность.
                  </p>
                </div>
              </section>
            )}
          </main>

          <footer className="text-center text-[11px] sm:text-xs text-gray-500 pb-6">
            © {new Date().getFullYear()} Учебный симулятор · Финансовое состояние логистической организации
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>